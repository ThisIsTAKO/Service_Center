# Лабораторная работа №11 - Обработка исключений и валидация данных

## Описание

Данная лабораторная работа объединяет и модифицирует элементы из предыдущих работ (Lab1, Lab3, lab678) с акцентом на:
- **Полноценную обработку исключений** с использованием try-catch блоков
- **Валидацию входных данных** на всех этапах  
- **Вывод информативных popup-сообщений** при возникновении ошибок
- **Полный CRUD функционал** для работы с базой данных

## Структура проекта

### Основные файлы

1. **Program.cs** - точка входа приложения
2. **Models.cs** - модели данных с методами валидации
3. **DataService.cs** - сервис работы с данными
4. **Form1.cs** - главная форма с математическими расчётами
5. **Form2.cs** - форма работы со строками
6. **Form3.cs** - форма базы данных ломбарда
7. **ClientForm.cs** - диалоговая форма для работы с клиентами
8. **PledgeItemForm.cs** - диалоговая форма для залогового имущества

## Формы приложения

### Form1 - Математические расчёты (из Lab1)
**Возможности:**
- Расчёт функции `y = √(s+t) / (√2 * sin(x)) + ln(s/(p+s)) + (a*x)/(b+s)`
- Расчёт суммы ряда `S = Σ(xᵏ / k!)` для k от 1 до n
- Навигация к другим формам

**Обработка исключений:**
- ✅ Проверка формата всех входных данных
- ✅ Валидация диапазонов (dx > 0, x₀ < xₖ, n > 0)
- ✅ Обработка математических ошибок (деление на 0, логарифм от отрицательного)
- ✅ Обработка переполнения при вычислении факториала
- ✅ Popup-сообщения для каждого типа ошибки

### Form2 - Работа со строками (из Lab3)
**Возможности:**
- Поиск последовательности «,-» в строке
- Преобразование ФИО в формат «Фамилия И.О.»
- Объединение двух целых чисел в строку

**Обработка исключений:**
- ✅ Проверка на пустые строки
- ✅ Валидация формата ФИО (минимум 2 части)
- ✅ Проверка корректности целых чисел
- ✅ Обработка `FormatException` и `OverflowException`
- ✅ Popup-уведомления при ошибках ввода

### Form3 - База данных Ломбарда (из lab678)
**Возможности:**
- Просмотр данных о клиентах, залоговом имуществе и займах
- **Добавление** клиентов и залогового имущества через диалоговые формы
- **Редактирование** существующих записей
- **Удаление** записей с подтверждением
- Сохранение/загрузка данных из JSON
- Цветовое кодирование статусов займов

**Обработка исключений:**
- ✅ Проверка инициализации DataService
- ✅ Обработка ошибок загрузки/сохранения файлов
- ✅ Обработка `NullReferenceException` при отсутствии данных
- ✅ Обработка `UnauthorizedAccessException` при недостатке прав
- ✅ Обработка `IOException` при проблемах с файлами
- ✅ Обработка `InvalidCastException` при преобразовании данных
- ✅ Popup-сообщения для всех типов ошибок

### Диалоговые формы с валидацией

#### ClientForm - Работа с клиентами
**Поля:**
- Фамилия*, Имя*, Отчество
- Паспорт* (минимум 10 символов)
- Телефон*, Адрес
- Дата регистрации

**Валидация:**
- ✅ Проверка обязательных полей (помечены *)
- ✅ Проверка длины паспорта
- ✅ Валидация через метод `Client.Validate()`
- ✅ Popup-сообщения с указанием на проблемное поле
- ✅ Автофокус на поле с ошибкой

#### PledgeItemForm - Залоговое имущество
**Поля:**
- Наименование*, Категория* (ComboBox)
- Описание (многострочное)
- Оценочная стоимость* (NumericUpDown)
- Состояние* (ComboBox)

**Валидация:**
- ✅ Проверка обязательных полей
- ✅ Проверка положительной стоимости
- ✅ Валидация через метод `PledgeItem.Validate()`
- ✅ Popup-сообщения при ошибках

## Типы обрабатываемых исключений

1. **FormatException** - неверный формат числа
2. **OverflowException** - переполнение при вычислениях
3. **ArgumentException** - неверные аргументы (валидация)
4. **ArithmeticException** - математические ошибки
5. **DivideByZeroException** - деление на ноль
6. **NullReferenceException** - обращение к null
7. **UnauthorizedAccessException** - нет прав доступа
8. **IOException** - ошибки ввода-вывода
9. **JsonException** - ошибки парсинга JSON
10. **InvalidCastException** - ошибки преобразования типов
11. **InvalidOperationException** - недопустимая операция

## Ключевые особенности обработки исключений

### 1. Валидация на уровне UI
```csharp
if (string.IsNullOrWhiteSpace(txtLastName.Text))
{
    MessageBox.Show("Заполните поле \"Фамилия\"!", 
        "Ошибка валидации", MessageBoxButtons.OK, MessageBoxIcon.Warning);
    txtLastName.Focus();
    return;
}
```

### 2. Валидация на уровне моделей
```csharp
public void Validate()
{
    if (string.IsNullOrWhiteSpace(LastName))
        throw new ArgumentException("Фамилия не может быть пустой");
    
    if (PassportNumber.Length < 10)
        throw new ArgumentException("Номер паспорта должен содержать минимум 10 символов");
}
```

### 3. Специфичные обработчики
```csharp
try { /* операция */ }
catch (DivideByZeroException ex)
{
    MessageBox.Show($"Деление на ноль: {ex.Message}", ...);
}
catch (ArithmeticException ex)
{
    MessageBox.Show($"Математическая ошибка: {ex.Message}", ...);
}
catch (Exception ex)
{
    MessageBox.Show($"Неизвестная ошибка: {ex.Message}", ...);
}
```

### 4. Обработка на всех уровнях
- **UI уровень**: Валидация полей формы
- **Бизнес-логика**: Методы `Validate()` в моделях
- **Data Access**: Try-catch в DataService
- **Файловые операции**: Обработка IOException, UnauthorizedAccessException

## Запуск проекта

1. Откройте solution файл `lab11.sln` в Visual Studio или Rider
2. Убедитесь, что выбран .NET 8.0 или .NET 9.0 Windows framework
3. Запустите проект (F5)

## Использование

### Главное меню (Form1)
- Выберите вкладку для нужного расчёта
- Кнопки слева - переход к другим формам

### База данных ломбарда (Form3)
1. **Добавление**: Нажмите "Добавить" → Заполните форму → "Сохранить"
2. **Редактирование**: Выберите строку → "Изменить" → Измените данные → "Сохранить"
3. **Удаление**: Выберите строку → "Удалить" → Подтвердите
4. **Сохранение**: Нажмите "Сохранить" для записи в файл
5. **Обновление**: Нажмите "Обновить" для перезагрузки из файла

## Что было добавлено

### Из Lab1:
- ✅ Полная валидация всех параметров
- ✅ Каждая ошибка выводится через MessageBox
- ✅ Добавлены проверки на переполнение
- ✅ Автофокус на проблемное поле

### Из Lab3:
- ✅ Обработка пустых строк
- ✅ Валидация формата ФИО
- ✅ Обработка OverflowException для чисел

### Из lab678:
- ✅ Все методы DataService обёрнуты в try-catch
- ✅ Popup-уведомления для каждой операции
- ✅ Проверка инициализации сервиса
- ✅ Обработка ошибок доступа к файлам
- ✅ Полный CRUD функционал
- ✅ Диалоговые формы ClientForm и PledgeItemForm
- ✅ Все формы имеют полную валидацию

## Файлы данных

- **pawnshop_data.json** - база данных ломбарда (создаётся автоматически)

## Автор

Лабораторная работа №11 - МДК 02.02 Ничипорук

---

**Примечание**: Все popup-сообщения содержат понятное описание проблемы, конкретное значение (если применимо) и подсказку по исправлению.
